# 实验五 基于Scapy编写端口扫描器
杨林 2019302120111
## 实验目的
掌握网络扫描之端口状态探测的基本原理
## 实验环境
python+scapy
## 实验要求
禁止探测互联网上的 IP ，严格遵守网络安全相关法律法规

完成以下扫描技术的编程实现：
1. TCP connect scan / TCP stealth scan
2. TCP Xmas scan / TCP fin scan / TCP null scan
3. UDP scan

上述每种扫描技术的实现测试均需要测试端口状态为：开放、关闭 和 过滤 状态时的程序执行结果

提供每一次扫描测试的抓包结果并分析与课本中的扫描方法原理是否相符？如果不同，试分析原因；

在实验报告中详细说明实验网络环境拓扑、被测试 IP 的端口状态是如何模拟的

（可选）复刻 nmap 的上述扫描技术实现的命令行参数开关
## 进行实验的过程如下：
1. 已知攻击者主机，受害者主机，网关的ip地址如下图：
 ![](img/2.png)
 ![](img/3.png)
 ![](img/1.png)
 则创建网络拓扑图如下：
 ![](img/4.png)

2. 在受害者主机上安装ufw以控制端口状态
 ![](img/5.png)
 再继续安装dnsmasq以开启udp端口的状态
 ![](img/6.png)

3. 用nmaq检查被扫描主机的状态如下，所有端口均关闭
 ![](img/7.png)

4. 进行TCP connect scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/8.png)
     受害者主机抓包的结果为
     ![](img/9.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/10.png)
      ![](img/12.png)
       受害者主机抓包的结果为
       ![](img/13.png)
       注意：受害者主机开启端口以及抓包时所进行的操作如下
       ![](img/11.png)
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/14.png)
      ![](img/15.png)
      受害者主机抓包的结果为
      ![](img/16.png)
      注意：受害者主机进行端口过滤以及抓包时所进行的操作如下
      ![](img/17.png)

5. 进行TCP stealth scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/18.png)
     ![](img/20.png)
     受害者主机抓包的结果为
     ![](img/19.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/21.png)
      ![](img/22.png)
       受害者主机抓包的结果为
       ![](img/23.png)
       注意：受害者主机开启端口以及抓包时所进行的操作与前一个实验的要求相同
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/24.png)
      ![](img/26.png)
      受害者主机抓包的结果为
      ![](img/25.png)
      注意：受害者主机进行端口过滤以及抓包时所进行的操作也与之前相同

6. 进行TCP Xmas scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/27.png)
     ![](img/29.png)
     受害者主机抓包的结果为
     ![](img/28.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/30.png)
      ![](img/32.png)
       受害者主机抓包的结果为
       ![](img/31.png)
       注意：开启端口以及抓包时所进行的操作与前一个实验的要求相同
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/33.png)
      ![](img/34.png)
      受害者主机抓包的结果为
      ![](img/35.png)
      注意：进行端口过滤以及抓包时所进行的操作也与之前相同

7. 进行TCP fin scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/36.png)
     受害者主机抓包的结果为
     ![](img/37.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/39.png)
       受害者主机抓包的结果为
       ![](img/38.png)
       注意：开启端口以及抓包时所进行的操作与前一个实验的要求相同
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/40.png)
      受害者主机抓包的结果为
      ![](img/41.png)
      注意：进行端口过滤以及抓包时所进行的操作也与之前相同

8. 进行TCP null scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/42.png)
     受害者主机抓包的结果为
     ![](img/43.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/45.png)
       受害者主机抓包的结果为
       ![](img/44.png)
       注意：开启端口以及抓包时所进行的操作与前一个实验的要求相同
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/46.png)
      受害者主机抓包的结果为
      ![](img/47.png)
      注意：进行端口过滤以及抓包时所进行的操作也与之前相同

9. 进行UDP scan的实验，代码在code文件
   
   * 端口状态：关闭
      
      攻击者主机运行代码并使用nmaq检查时的结果如下
     ![](img/49.png)
     ![](img/48.png)
     受害者主机抓包的结果为
     ![](img/50.png)
    
    * 端口状态：开启

      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/51.png)
       受害者主机抓包的结果为
       ![](img/52.png)
       注意：开启端口以及抓包时所进行的操作与前一个实验的要求相同
    
    * 端口状态：过滤
  
      攻击者主机运行代码并使用nmaq检查时的结果如下
      ![](img/54.png)
      受害者主机抓包的结果为
      ![](img/55.png)
      注意：进行端口过滤以及抓包时所进行的操作为
      ![](img/53.png)

提供每一次扫描测试的抓包结果并分析与课本中的扫描方法原理是否相符？如果不同，试分析原因；
原理相同